Return-Path: <freedreno-bounces@lists.freedesktop.org>
X-Original-To: lists+freedreno@lfdr.de
Delivered-To: lists+freedreno@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 74507256EB
	for <lists+freedreno@lfdr.de>; Tue, 21 May 2019 19:43:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 38448895A8;
	Tue, 21 May 2019 17:43:39 +0000 (UTC)
X-Original-To: freedreno@lists.freedesktop.org
Delivered-To: freedreno@lists.freedesktop.org
Received: from foss.arm.com (usa-sjc-mx-foss1.foss.arm.com [217.140.101.70])
 by gabe.freedesktop.org (Postfix) with ESMTP id 1F0CE895A8
 for <freedreno@lists.freedesktop.org>; Tue, 21 May 2019 17:43:38 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id ABB9B80D;
 Tue, 21 May 2019 10:43:37 -0700 (PDT)
Received: from [10.1.196.75] (e110467-lin.cambridge.arm.com [10.1.196.75])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 9D20C3F718;
 Tue, 21 May 2019 10:43:35 -0700 (PDT)
To: Jordan Crouse <jcrouse@codeaurora.org>, freedreno@lists.freedesktop.org
References: <1558455243-32746-1-git-send-email-jcrouse@codeaurora.org>
 <1558455243-32746-2-git-send-email-jcrouse@codeaurora.org>
From: Robin Murphy <robin.murphy@arm.com>
Message-ID: <6c5898e5-4b14-b77b-15b7-e926233c07d0@arm.com>
Date: Tue, 21 May 2019 18:43:34 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.6.1
MIME-Version: 1.0
In-Reply-To: <1558455243-32746-2-git-send-email-jcrouse@codeaurora.org>
Content-Language: en-GB
Subject: Re: [Freedreno] [PATCH v2 01/15] iommu/arm-smmu: Allow IOMMU
 enabled devices to skip DMA domains
X-BeenThere: freedreno@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Freedreno graphics driver community testing & development
 <freedreno.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/freedreno>,
 <mailto:freedreno-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/freedreno>
List-Post: <mailto:freedreno@lists.freedesktop.org>
List-Help: <mailto:freedreno-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/freedreno>,
 <mailto:freedreno-request@lists.freedesktop.org?subject=subscribe>
Cc: jean-philippe.brucker@arm.com, linux-arm-msm@vger.kernel.org,
 Joerg Roedel <joro@8bytes.org>, Will Deacon <will.deacon@arm.com>,
 dianders@chromium.org, linux-kernel@vger.kernel.org,
 iommu@lists.linux-foundation.org, hoegsberg@google.com,
 linux-arm-kernel@lists.infradead.org
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: freedreno-bounces@lists.freedesktop.org
Sender: "Freedreno" <freedreno-bounces@lists.freedesktop.org>

T24gMjEvMDUvMjAxOSAxNzoxMywgSm9yZGFuIENyb3VzZSB3cm90ZToKPiBBbGxvdyBJT01NVSBl
bmFibGVkIGRldmljZXMgc3BlY2lmaWVkIG9uIGFuIG9wdC1pbiBsaXN0IHRvIGNyZWF0ZSBhCj4g
ZGVmYXVsdCBpZGVudGl0eSBkb21haW4gZm9yIGEgbmV3IElPTU1VIGdyb3VwIGFuZCBieXBhc3Mg
dGhlIERNQQo+IGRvbWFpbiBjcmVhdGVkIGJ5IHRoZSBJT01NVSBjb3JlLiBUaGlzIGFsbG93cyB0
aGUgZ3JvdXAgdG8gYmUgcHJvcGVybHkKPiBzZXQgdXAgYnV0IG90aGVyd2lzZSBza2lwcyB0b3Vj
aGluZyB0aGUgaGFyZHdhcmUgdW50aWwgdGhlIGNsaWVudAo+IGRldmljZSBhdHRhY2hlcyBhIHVu
bWFuYWdlZCBkb21haW4gb2YgaXRzIG93bi4KCkFsbCB0aGUgY29vbCBraWRzIGFyZSB1c2luZyBp
b21tdV9yZXF1ZXN0X2RtX2Zvcl9kZXYoKSB0byBmb3JjZSBhbiAKaWRlbnRpdHkgZG9tYWluIGZv
ciBwYXJ0aWN1bGFyIGRldmljZXMsIHdvbid0IHRoYXQgc3VmZmljZSBmb3IgdGhpcyBjYXNlIAp0
b28/IFRoZXJlIGlzIGRlZmluaXRlIHNjb3BlIGZvciBpbXByb3ZlbWVudCBpbiB0aGlzIGFyZWEs
IHNvIEknZCByZWFsbHkgCmxpa2UgdG8ga2VlcCB0aGluZ3MgYXMgY29uc2lzdGVudCBhcyBwb3Nz
aWJsZSB0byBtYWtlIHRoYXQgZWFzaWVyIGluIGZ1dHVyZS4KClJvYmluLgoKPiBTaWduZWQtb2Zm
LWJ5OiBKb3JkYW4gQ3JvdXNlIDxqY3JvdXNlQGNvZGVhdXJvcmEub3JnPgo+IC0tLQo+IAo+ICAg
ZHJpdmVycy9pb21tdS9hcm0tc21tdS5jIHwgNDIgKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrCj4gICBkcml2ZXJzL2lvbW11L2lvbW11LmMgICAgfCAyOSArKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLQo+ICAgaW5jbHVkZS9saW51eC9pb21tdS5oICAgIHwgIDMg
KysrCj4gICAzIGZpbGVzIGNoYW5nZWQsIDY4IGluc2VydGlvbnMoKyksIDYgZGVsZXRpb25zKC0p
Cj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvaW9tbXUvYXJtLXNtbXUuYyBiL2RyaXZlcnMvaW9t
bXUvYXJtLXNtbXUuYwo+IGluZGV4IDVlNTRjYzAuLmE3OTVhZGEgMTAwNjQ0Cj4gLS0tIGEvZHJp
dmVycy9pb21tdS9hcm0tc21tdS5jCj4gKysrIGIvZHJpdmVycy9pb21tdS9hcm0tc21tdS5jCj4g
QEAgLTEyMzUsNiArMTIzNSwzNSBAQCBzdGF0aWMgaW50IGFybV9zbW11X2RvbWFpbl9hZGRfbWFz
dGVyKHN0cnVjdCBhcm1fc21tdV9kb21haW4gKnNtbXVfZG9tYWluLAo+ICAgCXJldHVybiAwOwo+
ICAgfQo+ICAgCj4gK3N0cnVjdCBhcm1fc21tdV9jbGllbnRfbWF0Y2hfZGF0YSB7Cj4gKwlib29s
IHVzZV9pZGVudGl0eV9kb21haW47Cj4gK307Cj4gKwo+ICtzdGF0aWMgY29uc3Qgc3RydWN0IGFy
bV9zbW11X2NsaWVudF9tYXRjaF9kYXRhIHFjb21fYWRyZW5vID0gewo+ICsJLnVzZV9pZGVudGl0
eV9kb21haW4gPSB0cnVlLAo+ICt9Owo+ICsKPiArc3RhdGljIGNvbnN0IHN0cnVjdCBhcm1fc21t
dV9jbGllbnRfbWF0Y2hfZGF0YSBxY29tX21kc3MgPSB7Cj4gKwkudXNlX2lkZW50aXR5X2RvbWFp
biA9IHRydWUsCj4gK307Cj4gKwo+ICtzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBh
cm1fc21tdV9jbGllbnRfb2ZfbWF0Y2hbXSA9IHsKPiArCXsgLmNvbXBhdGlibGUgPSAicWNvbSxh
ZHJlbm8iLCAuZGF0YSA9ICZxY29tX2FkcmVubyB9LAo+ICsJeyAuY29tcGF0aWJsZSA9ICJxY29t
LG1kcDQiLCAuZGF0YSA9ICZxY29tX21kc3MgfSwKPiArCXsgLmNvbXBhdGlibGUgPSAicWNvbSxt
ZHNzIiwgLmRhdGEgPSAmcWNvbV9tZHNzIH0sCj4gKwl7IC5jb21wYXRpYmxlID0gInFjb20sc2Rt
ODQ1LW1kc3MiLCAuZGF0YSA9ICZxY29tX21kc3MgfSwKPiArCXt9LAo+ICt9Owo+ICsKPiArc3Rh
dGljIGNvbnN0IHN0cnVjdCBhcm1fc21tdV9jbGllbnRfbWF0Y2hfZGF0YSAqCj4gK2FybV9zbW11
X2NsaWVudF9kYXRhKHN0cnVjdCBkZXZpY2UgKmRldikKPiArewo+ICsJY29uc3Qgc3RydWN0IG9m
X2RldmljZV9pZCAqbWF0Y2ggPQo+ICsJCW9mX21hdGNoX2RldmljZShhcm1fc21tdV9jbGllbnRf
b2ZfbWF0Y2gsIGRldik7Cj4gKwo+ICsJcmV0dXJuIG1hdGNoID8gbWF0Y2gtPmRhdGEgOiBOVUxM
Owo+ICt9Cj4gKwo+ICAgc3RhdGljIGludCBhcm1fc21tdV9hdHRhY2hfZGV2KHN0cnVjdCBpb21t
dV9kb21haW4gKmRvbWFpbiwgc3RydWN0IGRldmljZSAqZGV2KQo+ICAgewo+ICAgCWludCByZXQ7
Cj4gQEAgLTE1NTIsNiArMTU4MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmFybV9z
bW11X2RldmljZV9ncm91cChzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gICB7Cj4gICAJc3RydWN0IGlv
bW11X2Z3c3BlYyAqZndzcGVjID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KTsKPiAgIAlzdHJ1
Y3QgYXJtX3NtbXVfZGV2aWNlICpzbW11ID0gZndzcGVjX3NtbXUoZndzcGVjKTsKPiArCWNvbnN0
IHN0cnVjdCBhcm1fc21tdV9jbGllbnRfbWF0Y2hfZGF0YSAqY2xpZW50Owo+ICAgCXN0cnVjdCBp
b21tdV9ncm91cCAqZ3JvdXAgPSBOVUxMOwo+ICAgCWludCBpLCBpZHg7Cj4gICAKPiBAQCAtMTU3
Myw2ICsxNjAzLDE4IEBAIHN0YXRpYyBzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmFybV9zbW11X2Rldmlj
ZV9ncm91cChzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gICAJZWxzZQo+ICAgCQlncm91cCA9IGdlbmVy
aWNfZGV2aWNlX2dyb3VwKGRldik7Cj4gICAKPiArCWNsaWVudCA9IGFybV9zbW11X2NsaWVudF9k
YXRhKGRldik7Cj4gKwo+ICsJLyoKPiArCSAqIElmIHRoZSBjbGllbnQgY2hvb3NlcyB0byBieXBh
c3MgdGhlIGRtYSBkb21haW4sIGNyZWF0ZSBhIGlkZW50aXR5Cj4gKwkgKiBkb21haW4gYXMgYSBk
ZWZhdWx0IHBsYWNlaG9sZGVyLiBUaGlzIHdpbGwgZ2l2ZSB0aGUgZGV2aWNlIGEKPiArCSAqIGRl
ZmF1bHQgZG9tYWluIGJ1dCBza2lwIERNQSBvcGVyYXRpb25zIGFuZCBub3QgY29uc3VtZSBhIGNv
bnRleHQKPiArCSAqIGJhbmsKPiArCSAqLwo+ICsJaWYgKGNsaWVudCAmJiBjbGllbnQtPm5vX2Rt
YV9kb21haW4pCj4gKwkJaW9tbXVfZ3JvdXBfc2V0X2RlZmF1bHRfZG9tYWluKGdyb3VwLCBkZXYs
Cj4gKwkJCUlPTU1VX0RPTUFJTl9JREVOVElUWSk7Cj4gKwo+ICAgCXJldHVybiBncm91cDsKPiAg
IH0KPiAgIAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2lvbW11L2lvbW11LmMgYi9kcml2ZXJzL2lv
bW11L2lvbW11LmMKPiBpbmRleCA2N2VlNjYyLi5hZjNlMWVkIDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvaW9tbXUvaW9tbXUuYwo+ICsrKyBiL2RyaXZlcnMvaW9tbXUvaW9tbXUuYwo+IEBAIC0xMDYy
LDYgKzEwNjIsMjQgQEAgc3RydWN0IGlvbW11X2dyb3VwICpmc2xfbWNfZGV2aWNlX2dyb3VwKHN0
cnVjdCBkZXZpY2UgKmRldikKPiAgIAlyZXR1cm4gZ3JvdXA7Cj4gICB9Cj4gICAKPiArc3RydWN0
IGlvbW11X2RvbWFpbiAqaW9tbXVfZ3JvdXBfc2V0X2RlZmF1bHRfZG9tYWluKHN0cnVjdCBpb21t
dV9ncm91cCAqZ3JvdXAsCj4gKwkJc3RydWN0IGRldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgdHlw
ZSkKPiArewo+ICsJc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tOwo+ICsKPiArCWRvbSA9IF9faW9t
bXVfZG9tYWluX2FsbG9jKGRldi0+YnVzLCB0eXBlKTsKPiArCWlmICghZG9tKQo+ICsJCXJldHVy
biBOVUxMOwo+ICsKPiArCS8qIEZJWE1FOiBFcnJvciBpZiB0aGUgZGVmYXVsdCBkb21haW4gaXMg
YWxyZWFkeSBzZXQ/ICovCj4gKwlncm91cC0+ZGVmYXVsdF9kb21haW4gPSBkb207Cj4gKwlpZiAo
IWdyb3VwLT5kb21haW4pCj4gKwkJZ3JvdXAtPmRvbWFpbiA9IGRvbTsKPiArCj4gKwlyZXR1cm4g
ZG9tOwo+ICt9Cj4gK0VYUE9SVF9TWU1CT0xfR1BMKGlvbW11X2dyb3VwX3NldF9kZWZhdWx0X2Rv
bWFpbik7Cj4gKwo+ICAgLyoqCj4gICAgKiBpb21tdV9ncm91cF9nZXRfZm9yX2RldiAtIEZpbmQg
b3IgY3JlYXRlIHRoZSBJT01NVSBncm91cCBmb3IgYSBkZXZpY2UKPiAgICAqIEBkZXY6IHRhcmdl
dCBkZXZpY2UKPiBAQCAtMTA5OSw5ICsxMTE3LDEyIEBAIHN0cnVjdCBpb21tdV9ncm91cCAqaW9t
bXVfZ3JvdXBfZ2V0X2Zvcl9kZXYoc3RydWN0IGRldmljZSAqZGV2KQo+ICAgCWlmICghZ3JvdXAt
PmRlZmF1bHRfZG9tYWluKSB7Cj4gICAJCXN0cnVjdCBpb21tdV9kb21haW4gKmRvbTsKPiAgIAo+
IC0JCWRvbSA9IF9faW9tbXVfZG9tYWluX2FsbG9jKGRldi0+YnVzLCBpb21tdV9kZWZfZG9tYWlu
X3R5cGUpOwo+ICsJCWRvbSA9IGlvbW11X2dyb3VwX3NldF9kZWZhdWx0X2RvbWFpbihncm91cCwg
ZGV2LAo+ICsJCQlpb21tdV9kZWZfZG9tYWluX3R5cGUpOwo+ICsKPiAgIAkJaWYgKCFkb20gJiYg
aW9tbXVfZGVmX2RvbWFpbl90eXBlICE9IElPTU1VX0RPTUFJTl9ETUEpIHsKPiAtCQkJZG9tID0g
X19pb21tdV9kb21haW5fYWxsb2MoZGV2LT5idXMsIElPTU1VX0RPTUFJTl9ETUEpOwo+ICsJCQlk
b20gPSBpb21tdV9ncm91cF9zZXRfZGVmYXVsdF9kb21haW4oZ3JvdXAsIGRldiwKPiArCQkJCUlP
TU1VX0RPTUFJTl9ETUEpOwo+ICAgCQkJaWYgKGRvbSkgewo+ICAgCQkJCWRldl93YXJuKGRldiwK
PiAgIAkJCQkJICJmYWlsZWQgdG8gYWxsb2NhdGUgZGVmYXVsdCBJT01NVSBkb21haW4gb2YgdHlw
ZSAldTsgZmFsbGluZyBiYWNrIHRvIElPTU1VX0RPTUFJTl9ETUEiLAo+IEBAIC0xMTA5LDEwICsx
MTMwLDYgQEAgc3RydWN0IGlvbW11X2dyb3VwICppb21tdV9ncm91cF9nZXRfZm9yX2RldihzdHJ1
Y3QgZGV2aWNlICpkZXYpCj4gICAJCQl9Cj4gICAJCX0KPiAgIAo+IC0JCWdyb3VwLT5kZWZhdWx0
X2RvbWFpbiA9IGRvbTsKPiAtCQlpZiAoIWdyb3VwLT5kb21haW4pCj4gLQkJCWdyb3VwLT5kb21h
aW4gPSBkb207Cj4gLQo+ICAgCQlpZiAoZG9tICYmICFpb21tdV9kbWFfc3RyaWN0KSB7Cj4gICAJ
CQlpbnQgYXR0ciA9IDE7Cj4gICAJCQlpb21tdV9kb21haW5fc2V0X2F0dHIoZG9tLAo+IGRpZmYg
LS1naXQgYS9pbmNsdWRlL2xpbnV4L2lvbW11LmggYi9pbmNsdWRlL2xpbnV4L2lvbW11LmgKPiBp
bmRleCBhODE1Y2Y2Li40ZWY4YmQ1IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvbGludXgvaW9tbXUu
aAo+ICsrKyBiL2luY2x1ZGUvbGludXgvaW9tbXUuaAo+IEBAIC0zOTQsNiArMzk0LDkgQEAgZXh0
ZXJuIGludCBpb21tdV9ncm91cF9pZChzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmdyb3VwKTsKPiAgIGV4
dGVybiBzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmlvbW11X2dyb3VwX2dldF9mb3JfZGV2KHN0cnVjdCBk
ZXZpY2UgKmRldik7Cj4gICBleHRlcm4gc3RydWN0IGlvbW11X2RvbWFpbiAqaW9tbXVfZ3JvdXBf
ZGVmYXVsdF9kb21haW4oc3RydWN0IGlvbW11X2dyb3VwICopOwo+ICAgCj4gK3N0cnVjdCBpb21t
dV9kb21haW4gKmlvbW11X2dyb3VwX3NldF9kZWZhdWx0X2RvbWFpbihzdHJ1Y3QgaW9tbXVfZ3Jv
dXAgKmdyb3VwLAo+ICsJCXN0cnVjdCBkZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHR5cGUpOwo+
ICsKPiAgIGV4dGVybiBpbnQgaW9tbXVfZG9tYWluX2dldF9hdHRyKHN0cnVjdCBpb21tdV9kb21h
aW4gKmRvbWFpbiwgZW51bSBpb21tdV9hdHRyLAo+ICAgCQkJCSB2b2lkICpkYXRhKTsKPiAgIGV4
dGVybiBpbnQgaW9tbXVfZG9tYWluX3NldF9hdHRyKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFp
biwgZW51bSBpb21tdV9hdHRyLAo+IApfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpGcmVlZHJlbm8gbWFpbGluZyBsaXN0CkZyZWVkcmVub0BsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9mcmVlZHJlbm8=
