Return-Path: <freedreno-bounces@lists.freedesktop.org>
X-Original-To: lists+freedreno@lfdr.de
Delivered-To: lists+freedreno@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B28722552F
	for <lists+freedreno@lfdr.de>; Tue, 21 May 2019 18:14:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 519AD8949C;
	Tue, 21 May 2019 16:14:35 +0000 (UTC)
X-Original-To: freedreno@lists.freedesktop.org
Delivered-To: freedreno@lists.freedesktop.org
Received: from smtp.codeaurora.org (smtp.codeaurora.org [198.145.29.96])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 249AF89483
 for <freedreno@lists.freedesktop.org>; Tue, 21 May 2019 16:14:33 +0000 (UTC)
Received: by smtp.codeaurora.org (Postfix, from userid 1000)
 id AF44F61A1E; Tue, 21 May 2019 16:14:17 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
 pdx-caf-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=2.0 tests=ALL_TRUSTED,BAYES_00,
 DKIM_INVALID,DKIM_SIGNED,SPF_NONE autolearn=no autolearn_force=no
 version=3.4.0
Received: from jcrouse1-lnx.qualcomm.com (i-global254.qualcomm.com
 [199.106.103.254])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: jcrouse@smtp.codeaurora.org)
 by smtp.codeaurora.org (Postfix) with ESMTPSA id 72CBE611FD;
 Tue, 21 May 2019 16:14:13 +0000 (UTC)
DMARC-Filter: OpenDMARC Filter v1.3.2 smtp.codeaurora.org 72CBE611FD
From: Jordan Crouse <jcrouse@codeaurora.org>
To: freedreno@lists.freedesktop.org
Date: Tue, 21 May 2019 10:13:51 -0600
Message-Id: <1558455243-32746-4-git-send-email-jcrouse@codeaurora.org>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1558455243-32746-1-git-send-email-jcrouse@codeaurora.org>
References: <1558455243-32746-1-git-send-email-jcrouse@codeaurora.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=codeaurora.org; s=default; t=1558455272;
 bh=zK9RPyifG7tYABiCXCNew7jEdoS+xD1s/QJqmXUeVFQ=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=CyFZLNnfjUmN6E4BXbtmERfJOXNZmbzDHI7tnWAFNmQQsr5qNotQd5LDOZxchv4Fo
 KNZEGC41w4oJhzVivvXL4YXT+0KtbAC7o9IEGsPwuqbmOgZOvjxrCM/5x21NW+fE51
 rZKxjwCLNd5kSL4l+lh/PawgKhw28oAJkej1Vaac=
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=codeaurora.org; s=default; t=1558455254;
 bh=zK9RPyifG7tYABiCXCNew7jEdoS+xD1s/QJqmXUeVFQ=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=mXMnu7s7OS2yYC7kXkaX4OfK91tM8UiixaXldIlpG2jWomtp9uFSzql42VFarFd2V
 gta1zUYRoOFrjISUnygdOxpoSdgGVNLxTd86kNPXO5yZXQIzPcVICk175T+hUZM1tt
 PNN8fEhHYtuYfU5TlW+MJXxUAIV7YysLb7ZFr6ts=
X-Mailman-Original-Authentication-Results: pdx-caf-mail.web.codeaurora.org;
 dmarc=none (p=none dis=none)
 header.from=codeaurora.org
X-Mailman-Original-Authentication-Results: pdx-caf-mail.web.codeaurora.org;
 spf=none
 smtp.mailfrom=jcrouse@codeaurora.org
Subject: [Freedreno] [PATCH v2 03/15] iommu/arm-smmu: Add split pagetable
 support for arm-smmu-v2
X-BeenThere: freedreno@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Freedreno graphics driver community testing & development
 <freedreno.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/freedreno>,
 <mailto:freedreno-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/freedreno>
List-Post: <mailto:freedreno@lists.freedesktop.org>
List-Help: <mailto:freedreno-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/freedreno>,
 <mailto:freedreno-request@lists.freedesktop.org?subject=subscribe>
Cc: jean-philippe.brucker@arm.com, linux-arm-msm@vger.kernel.org,
 Joerg Roedel <joro@8bytes.org>, Will Deacon <will.deacon@arm.com>,
 dianders@chromium.org, linux-kernel@vger.kernel.org,
 iommu@lists.linux-foundation.org, hoegsberg@google.com,
 Robin Murphy <robin.murphy@arm.com>, linux-arm-kernel@lists.infradead.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: freedreno-bounces@lists.freedesktop.org
Sender: "Freedreno" <freedreno-bounces@lists.freedesktop.org>

QWRkIHN1cHBvcnQgZm9yIGEgc3BsaXQgcGFnZXRhYmxlIChUVEJSMC9UVEJSMSkgc2NoZW1lIGZv
ciBhcm0tc21tdS12Mi4KSWYgc3BsaXQgcGFnZXRhYmxlcyBhcmUgZW5hYmxlZCwgY3JlYXRlIGEg
cGFnZXRhYmxlIGZvciBUVEJSMSBhbmQgc2V0CnVwIHRoZSBzaWduIGV4dGVuc2lvbiBiaXQgc28g
dGhhdCBhbGwgSU9WQXMgd2l0aCB0aGF0IGJpdCBzZXQgYXJlIG1hcHBlZAphbmQgdHJhbnNsYXRl
ZCBmcm9tIHRoZSBUVEJSMSBwYWdldGFibGUuCgpTaWduZWQtb2ZmLWJ5OiBKb3JkYW4gQ3JvdXNl
IDxqY3JvdXNlQGNvZGVhdXJvcmEub3JnPgotLS0KCiBkcml2ZXJzL2lvbW11L2FybS1zbW11LXJl
Z3MuaCAgfCAgMTkgKysrKysKIGRyaXZlcnMvaW9tbXUvYXJtLXNtbXUuYyAgICAgICB8IDE3OSAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQogZHJpdmVycy9pb21tdS9p
by1wZ3RhYmxlLWFybS5jIHwgICAzICstCiAzIGZpbGVzIGNoYW5nZWQsIDE4NiBpbnNlcnRpb25z
KCspLCAxNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2lvbW11L2FybS1zbW11
LXJlZ3MuaCBiL2RyaXZlcnMvaW9tbXUvYXJtLXNtbXUtcmVncy5oCmluZGV4IGU5MTMyYTkuLjIz
ZjI3YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvaW9tbXUvYXJtLXNtbXUtcmVncy5oCisrKyBiL2Ry
aXZlcnMvaW9tbXUvYXJtLXNtbXUtcmVncy5oCkBAIC0xOTUsNyArMTk1LDI2IEBAIGVudW0gYXJt
X3NtbXVfczJjcl9wcml2Y2ZnIHsKICNkZWZpbmUgUkVTVU1FX1JFVFJZCQkJKDAgPDwgMCkKICNk
ZWZpbmUgUkVTVU1FX1RFUk1JTkFURQkJKDEgPDwgMCkKIAorI2RlZmluZSBUVEJDUl9FUEQxCQkJ
KDEgPDwgMjMpCisjZGVmaW5lIFRUQkNSX1QwU1pfU0hJRlQJCTAKKyNkZWZpbmUgVFRCQ1JfVDFT
Wl9TSElGVAkJMTYKKyNkZWZpbmUgVFRCQ1JfSVJHTjFfU0hJRlQJCTI0CisjZGVmaW5lIFRUQkNS
X09SR04xX1NISUZUCQkyNgorI2RlZmluZSBUVEJDUl9SR05fV0JXQQkJCTEKKyNkZWZpbmUgVFRC
Q1JfU0gxX1NISUZUCQkJMjgKKyNkZWZpbmUgVFRCQ1JfU0hfSVMJCQkzCisKKyNkZWZpbmUgVFRC
Q1JfVEcxXzE2SwkJCSgxIDw8IDMwKQorI2RlZmluZSBUVEJDUl9URzFfNEsJCQkoMiA8PCAzMCkK
KyNkZWZpbmUgVFRCQ1JfVEcxXzY0SwkJCSgzIDw8IDMwKQorCiAjZGVmaW5lIFRUQkNSMl9TRVBf
U0hJRlQJCTE1CisjZGVmaW5lIFRUQkNSMl9TRVBfMzEJCQkoMHgwIDw8IFRUQkNSMl9TRVBfU0hJ
RlQpCisjZGVmaW5lIFRUQkNSMl9TRVBfMzUJCQkoMHgxIDw8IFRUQkNSMl9TRVBfU0hJRlQpCisj
ZGVmaW5lIFRUQkNSMl9TRVBfMzkJCQkoMHgyIDw8IFRUQkNSMl9TRVBfU0hJRlQpCisjZGVmaW5l
IFRUQkNSMl9TRVBfNDEJCQkoMHgzIDw8IFRUQkNSMl9TRVBfU0hJRlQpCisjZGVmaW5lIFRUQkNS
Ml9TRVBfNDMJCQkoMHg0IDw8IFRUQkNSMl9TRVBfU0hJRlQpCisjZGVmaW5lIFRUQkNSMl9TRVBf
NDcJCQkoMHg1IDw8IFRUQkNSMl9TRVBfU0hJRlQpCiAjZGVmaW5lIFRUQkNSMl9TRVBfVVBTVFJF
QU0JCSgweDcgPDwgVFRCQ1IyX1NFUF9TSElGVCkKICNkZWZpbmUgVFRCQ1IyX0FTCQkJKDEgPDwg
NCkKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9pb21tdS9hcm0tc21tdS5jIGIvZHJpdmVycy9pb21t
dS9hcm0tc21tdS5jCmluZGV4IGE3OTVhZGEuLmUwOWMwZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
aW9tbXUvYXJtLXNtbXUuYworKysgYi9kcml2ZXJzL2lvbW11L2FybS1zbW11LmMKQEAgLTE1Miw2
ICsxNTIsNyBAQCBzdHJ1Y3QgYXJtX3NtbXVfY2IgewogCXUzMgkJCQl0Y3JbMl07CiAJdTMyCQkJ
CW1haXJbMl07CiAJc3RydWN0IGFybV9zbW11X2NmZwkJKmNmZzsKKwl1bnNpZ25lZCBsb25nCQkJ
c3BsaXRfdGFibGVfbWFzazsKIH07CiAKIHN0cnVjdCBhcm1fc21tdV9tYXN0ZXJfY2ZnIHsKQEAg
LTI1MywxMyArMjU0LDE0IEBAIGVudW0gYXJtX3NtbXVfZG9tYWluX3N0YWdlIHsKIAogc3RydWN0
IGFybV9zbW11X2RvbWFpbiB7CiAJc3RydWN0IGFybV9zbW11X2RldmljZQkJKnNtbXU7Ci0Jc3Ry
dWN0IGlvX3BndGFibGVfb3BzCQkqcGd0Ymxfb3BzOworCXN0cnVjdCBpb19wZ3RhYmxlX29wcwkJ
KnBndGJsX29wc1syXTsKIAljb25zdCBzdHJ1Y3QgaW9tbXVfZ2F0aGVyX29wcwkqdGxiX29wczsK
IAlzdHJ1Y3QgYXJtX3NtbXVfY2ZnCQljZmc7CiAJZW51bSBhcm1fc21tdV9kb21haW5fc3RhZ2UJ
c3RhZ2U7CiAJYm9vbAkJCQlub25fc3RyaWN0OwogCXN0cnVjdCBtdXRleAkJCWluaXRfbXV0ZXg7
IC8qIFByb3RlY3RzIHNtbXUgcG9pbnRlciAqLwogCXNwaW5sb2NrX3QJCQljYl9sb2NrOyAvKiBT
ZXJpYWxpc2VzIEFUUzEqIG9wcyBhbmQgVExCIHN5bmNzICovCisJdTMyIGF0dHJpYnV0ZXM7CiAJ
c3RydWN0IGlvbW11X2RvbWFpbgkJZG9tYWluOwogfTsKIApAQCAtNjIxLDYgKzYyMyw4NSBAQCBz
dGF0aWMgaXJxcmV0dXJuX3QgYXJtX3NtbXVfZ2xvYmFsX2ZhdWx0KGludCBpcnEsIHZvaWQgKmRl
dikKIAlyZXR1cm4gSVJRX0hBTkRMRUQ7CiB9CiAKKy8qIEFkanVzdCB0aGUgY29udGV4dCBiYW5r
IHNldHRpbmdzIHRvIHN1cHBvcnQgVFRCUjEgKi8KK3N0YXRpYyB2b2lkIGFybV9zbW11X2luaXRf
dHRicjEoc3RydWN0IGFybV9zbW11X2RvbWFpbiAqc21tdV9kb21haW4sCisJCXN0cnVjdCBpb19w
Z3RhYmxlX2NmZyAqcGd0YmxfY2ZnKQoreworCXN0cnVjdCBhcm1fc21tdV9kZXZpY2UgKnNtbXUg
PSBzbW11X2RvbWFpbi0+c21tdTsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2ZnICpjZmcgPSAmc21tdV9k
b21haW4tPmNmZzsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2IgKmNiID0gJnNtbXVfZG9tYWluLT5zbW11
LT5jYnNbY2ZnLT5jYm5keF07CisJaW50IHBnc2l6ZSA9IDEgPDwgX19mZnMocGd0YmxfY2ZnLT5w
Z3NpemVfYml0bWFwKTsKKworCS8qIEVuYWJsZSBzcGVjdWxhdGl2ZSB3YWxrcyB0aHJvdWdoIHRo
ZSBUVEJSMSAqLworCWNiLT50Y3JbMF0gJj0gflRUQkNSX0VQRDE7CisKKwljYi0+dGNyWzBdIHw9
IFRUQkNSX1NIX0lTIDw8IFRUQkNSX1NIMV9TSElGVDsKKwljYi0+dGNyWzBdIHw9IFRUQkNSX1JH
Tl9XQldBIDw8IFRUQkNSX0lSR04xX1NISUZUOworCWNiLT50Y3JbMF0gfD0gVFRCQ1JfUkdOX1dC
V0EgPDwgVFRCQ1JfT1JHTjFfU0hJRlQ7CisKKwlzd2l0Y2ggKHBnc2l6ZSkgeworCWNhc2UgU1pf
NEs6CisJCWNiLT50Y3JbMF0gfD0gVFRCQ1JfVEcxXzRLOworCQlicmVhazsKKwljYXNlIFNaXzE2
SzoKKwkJY2ItPnRjclswXSB8PSBUVEJDUl9URzFfMTZLOworCQlicmVhazsKKwljYXNlIFNaXzY0
SzoKKwkJY2ItPnRjclswXSB8PSBUVEJDUl9URzFfNjRLOworCQlicmVhazsKKwl9CisKKwkvKgor
CSAqIE91dHNpZGUgb2YgdGhlIHNwZWNpYWwgNDkgYml0IFVCUyBjYXNlIHRoYXQgaGFzIGEgZGVk
aWNhdGVkIHNpZ24KKwkgKiBleHRlbnNpb24gYml0LCBzZXR0aW5nIHRoZSBTRVAgZm9yIGFueSBv
dGhlciB2YV9zaXplIHdpbGwgZm9yY2UgdXMgdG8KKwkgKiBzaHJpbmsgdGhlIHNpemUgb2YgdGhl
IFQwL1QxIHJlZ2lvbnMgYnkgb25lIGJpdCB0byBhY2NvbW1vZGF0ZSB0aGUKKwkgKiBTRVAKKwkg
Ki8KKwlpZiAoc21tdS0+dmFfc2l6ZSAhPSA0OCkgeworCQkvKiBSZXBsYWNlIHRoZSBUMCBzaXpl
ICovCisJCWNiLT50Y3JbMF0gJj0gfigweDNmIDw8IFRUQkNSX1QwU1pfU0hJRlQpOworCQljYi0+
dGNyWzBdIHw9ICg2NFVMTCAtIHNtbXUtPnZhX3NpemUgLSAxKSA8PCBUVEJDUl9UMFNaX1NISUZU
OworCQkvKiBTZXQgdGhlIFQxIHNpemUgKi8KKwkJY2ItPnRjclswXSB8PSAoNjRVTEwgLSBzbW11
LT52YV9zaXplIC0gMSkgPDwgVFRCQ1JfVDFTWl9TSElGVDsKKwl9IGVsc2UgeworCQkvKiBTZXQg
dGhlIFQxIHNpemUgdG8gdGhlIGZ1bGwgYXZhaWxhYmxlIFVCUyAqLworCQljYi0+dGNyWzBdIHw9
ICg2NFVMTCAtIHNtbXUtPnZhX3NpemUpIDw8IFRUQkNSX1QxU1pfU0hJRlQ7CisJfQorCisJLyog
Q2xlYXIgdGhlIGV4aXN0aW5nIFNFUCBjb25maWd1cmF0aW9uICovCisJY2ItPnRjclsxXSAmPSB+
VFRCQ1IyX1NFUF9VUFNUUkVBTTsKKworCS8qIFNldCB1cCB0aGUgc2lnbiBleHRlbmQgYml0ICov
CisJc3dpdGNoIChzbW11LT52YV9zaXplKSB7CisJY2FzZSAzMjoKKwkJY2ItPnRjclsxXSB8PSBU
VEJDUjJfU0VQXzMxOworCQljYi0+c3BsaXRfdGFibGVfbWFzayA9ICgxVUwgPDwgMzEpOworCQli
cmVhazsKKwljYXNlIDM2OgorCQljYi0+dGNyWzFdIHw9IFRUQkNSMl9TRVBfMzU7CisJCWNiLT5z
cGxpdF90YWJsZV9tYXNrID0gKDFVTCA8PCAzNSk7CisJCWJyZWFrOworCWNhc2UgNDA6CisJCWNi
LT50Y3JbMV0gfD0gVFRCQ1IyX1NFUF8zOTsKKwkJY2ItPnNwbGl0X3RhYmxlX21hc2sgPSAoMVVM
IDw8IDM5KTsKKwkJYnJlYWs7CisJY2FzZSA0MjoKKwkJY2ItPnRjclsxXSB8PSBUVEJDUjJfU0VQ
XzQxOworCQljYi0+c3BsaXRfdGFibGVfbWFzayA9ICgxVUwgPDwgNDEpOworCQlicmVhazsKKwlj
YXNlIDQ0OgorCQljYi0+dGNyWzFdIHw9IFRUQkNSMl9TRVBfNDM7CisJCWNiLT5zcGxpdF90YWJs
ZV9tYXNrID0gKDFVTCA8PCA0Myk7CisJCWJyZWFrOworCWNhc2UgNDg6CisJCWNiLT50Y3JbMV0g
fD0gVFRCQ1IyX1NFUF9VUFNUUkVBTTsKKwkJY2ItPnNwbGl0X3RhYmxlX21hc2sgPSAoMVVMIDw8
IDQ4KTsKKwl9CisKKwljYi0+dHRiclsxXSA9IHBndGJsX2NmZy0+YXJtX2xwYWVfczFfY2ZnLnR0
YnJbMF07CisJY2ItPnR0YnJbMV0gfD0gKHU2NCljZmctPmFzaWQgPDwgVFRCUm5fQVNJRF9TSElG
VDsKK30KKwogc3RhdGljIHZvaWQgYXJtX3NtbXVfaW5pdF9jb250ZXh0X2Jhbmsoc3RydWN0IGFy
bV9zbW11X2RvbWFpbiAqc21tdV9kb21haW4sCiAJCQkJICAgICAgIHN0cnVjdCBpb19wZ3RhYmxl
X2NmZyAqcGd0YmxfY2ZnKQogewpAQCAtNzYzLDExICs4NDQsMTMgQEAgc3RhdGljIGludCBhcm1f
c21tdV9pbml0X2RvbWFpbl9jb250ZXh0KHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwKIHsK
IAlpbnQgaXJxLCBzdGFydCwgcmV0ID0gMDsKIAl1bnNpZ25lZCBsb25nIGlhcywgb2FzOwotCXN0
cnVjdCBpb19wZ3RhYmxlX29wcyAqcGd0Ymxfb3BzOworCXN0cnVjdCBpb19wZ3RhYmxlX29wcyAq
cGd0Ymxfb3BzWzJdID0geyBOVUxMLCBOVUxMIH07CiAJc3RydWN0IGlvX3BndGFibGVfY2ZnIHBn
dGJsX2NmZzsKIAllbnVtIGlvX3BndGFibGVfZm10IGZtdDsKIAlzdHJ1Y3QgYXJtX3NtbXVfZG9t
YWluICpzbW11X2RvbWFpbiA9IHRvX3NtbXVfZG9tYWluKGRvbWFpbik7CiAJc3RydWN0IGFybV9z
bW11X2NmZyAqY2ZnID0gJnNtbXVfZG9tYWluLT5jZmc7CisJYm9vbCBzcGxpdF90YWJsZXMgPQor
CQkoc21tdV9kb21haW4tPmF0dHJpYnV0ZXMgJiAoMSA8PCBET01BSU5fQVRUUl9TUExJVF9UQUJM
RVMpKTsKIAogCW11dGV4X2xvY2soJnNtbXVfZG9tYWluLT5pbml0X211dGV4KTsKIAlpZiAoc21t
dV9kb21haW4tPnNtbXUpCkBAIC03OTcsOCArODgwLDE1IEBAIHN0YXRpYyBpbnQgYXJtX3NtbXVf
aW5pdF9kb21haW5fY29udGV4dChzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sCiAJICoKIAkg
KiBOb3RlIHRoYXQgeW91IGNhbid0IGFjdHVhbGx5IHJlcXVlc3Qgc3RhZ2UtMiBtYXBwaW5ncy4K
IAkgKi8KLQlpZiAoIShzbW11LT5mZWF0dXJlcyAmIEFSTV9TTU1VX0ZFQVRfVFJBTlNfUzEpKQor
CWlmICghKHNtbXUtPmZlYXR1cmVzICYgQVJNX1NNTVVfRkVBVF9UUkFOU19TMSkpIHsKIAkJc21t
dV9kb21haW4tPnN0YWdlID0gQVJNX1NNTVVfRE9NQUlOX1MyOworCisJCS8qIE9ubHkgYWxsb3cg
c3BsaXQgcGFnZXRhYmxlcyBvbiBzdGFnZSAxIHRhYmxlcyAqLworCQlpZiAoc3BsaXRfdGFibGVz
KSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byBvdXRfdW5sb2NrOworCQl9CisJfQogCWlm
ICghKHNtbXUtPmZlYXR1cmVzICYgQVJNX1NNTVVfRkVBVF9UUkFOU19TMikpCiAJCXNtbXVfZG9t
YWluLT5zdGFnZSA9IEFSTV9TTU1VX0RPTUFJTl9TMTsKIApAQCAtODE3LDYgKzkwNyw3IEBAIHN0
YXRpYyBpbnQgYXJtX3NtbXVfaW5pdF9kb21haW5fY29udGV4dChzdHJ1Y3QgaW9tbXVfZG9tYWlu
ICpkb21haW4sCiAJICAgIChzbW11LT5mZWF0dXJlcyAmIEFSTV9TTU1VX0ZFQVRfRk1UX0FBUkNI
MzJfUykgJiYKIAkgICAgKHNtbXVfZG9tYWluLT5zdGFnZSA9PSBBUk1fU01NVV9ET01BSU5fUzEp
KQogCQljZmctPmZtdCA9IEFSTV9TTU1VX0NUWF9GTVRfQUFSQ0gzMl9TOworCiAJaWYgKChJU19F
TkFCTEVEKENPTkZJR182NEJJVCkgfHwgY2ZnLT5mbXQgPT0gQVJNX1NNTVVfQ1RYX0ZNVF9OT05F
KSAmJgogCSAgICAoc21tdS0+ZmVhdHVyZXMgJiAoQVJNX1NNTVVfRkVBVF9GTVRfQUFSQ0g2NF82
NEsgfAogCQkJICAgICAgIEFSTV9TTU1VX0ZFQVRfRk1UX0FBUkNINjRfMTZLIHwKQEAgLTgyOCw2
ICs5MTksMTIgQEAgc3RhdGljIGludCBhcm1fc21tdV9pbml0X2RvbWFpbl9jb250ZXh0KHN0cnVj
dCBpb21tdV9kb21haW4gKmRvbWFpbiwKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAorCS8qIEZv
ciBub3csIG9ubHkgYWxsb3cgc3BsaXQgdGFibGVzIGZvciBBQVJDSDY0IGZvcm1hdHMgKi8KKwlp
ZiAoc3BsaXRfdGFibGVzICYmIGNmZy0+Zm10ICE9IEFSTV9TTU1VX0NUWF9GTVRfQUFSQ0g2NCkg
eworCQlyZXQgPSAtRUlOVkFMOworCQlnb3RvIG91dF91bmxvY2s7CisJfQorCiAJc3dpdGNoIChz
bW11X2RvbWFpbi0+c3RhZ2UpIHsKIAljYXNlIEFSTV9TTU1VX0RPTUFJTl9TMToKIAkJY2ZnLT5j
YmFyID0gQ0JBUl9UWVBFX1MxX1RSQU5TX1MyX0JZUEFTUzsKQEAgLTkwNiw4ICsxMDAzLDggQEAg
c3RhdGljIGludCBhcm1fc21tdV9pbml0X2RvbWFpbl9jb250ZXh0KHN0cnVjdCBpb21tdV9kb21h
aW4gKmRvbWFpbiwKIAkJcGd0YmxfY2ZnLnF1aXJrcyB8PSBJT19QR1RBQkxFX1FVSVJLX05PTl9T
VFJJQ1Q7CiAKIAlzbW11X2RvbWFpbi0+c21tdSA9IHNtbXU7Ci0JcGd0Ymxfb3BzID0gYWxsb2Nf
aW9fcGd0YWJsZV9vcHMoZm10LCAmcGd0YmxfY2ZnLCBzbW11X2RvbWFpbik7Ci0JaWYgKCFwZ3Ri
bF9vcHMpIHsKKwlwZ3RibF9vcHNbMF0gPSBhbGxvY19pb19wZ3RhYmxlX29wcyhmbXQsICZwZ3Ri
bF9jZmcsIHNtbXVfZG9tYWluKTsKKwlpZiAoIXBndGJsX29wc1swXSkgewogCQlyZXQgPSAtRU5P
TUVNOwogCQlnb3RvIG91dF9jbGVhcl9zbW11OwogCX0KQEAgLTkxOSw2ICsxMDE2LDIwIEBAIHN0
YXRpYyBpbnQgYXJtX3NtbXVfaW5pdF9kb21haW5fY29udGV4dChzdHJ1Y3QgaW9tbXVfZG9tYWlu
ICpkb21haW4sCiAKIAkvKiBJbml0aWFsaXNlIHRoZSBjb250ZXh0IGJhbmsgd2l0aCBvdXIgcGFn
ZSB0YWJsZSBjZmcgKi8KIAlhcm1fc21tdV9pbml0X2NvbnRleHRfYmFuayhzbW11X2RvbWFpbiwg
JnBndGJsX2NmZyk7CisKKwlpZiAoc3BsaXRfdGFibGVzKSB7CisJCS8qIEl0IGlzIHNhZmUgdG8g
cmV1c2UgcGd0YmxfY2ZnIGhlcmUgKi8KKwkJcGd0Ymxfb3BzWzFdID0gYWxsb2NfaW9fcGd0YWJs
ZV9vcHMoZm10LCAmcGd0YmxfY2ZnLAorCQkJc21tdV9kb21haW4pOworCQlpZiAoIXBndGJsX29w
c1sxXSkgeworCQkJZnJlZV9pb19wZ3RhYmxlX29wcyhwZ3RibF9vcHNbMF0pOworCQkJcmV0ID0g
LUVOT01FTTsKKwkJCWdvdG8gb3V0X2NsZWFyX3NtbXU7CisJCX0KKworCQlhcm1fc21tdV9pbml0
X3R0YnIxKHNtbXVfZG9tYWluLCAmcGd0YmxfY2ZnKTsKKwl9CisKIAlhcm1fc21tdV93cml0ZV9j
b250ZXh0X2Jhbmsoc21tdSwgY2ZnLT5jYm5keCk7CiAKIAkvKgpAQCAtOTM3LDcgKzEwNDgsOSBA
QCBzdGF0aWMgaW50IGFybV9zbW11X2luaXRfZG9tYWluX2NvbnRleHQoc3RydWN0IGlvbW11X2Rv
bWFpbiAqZG9tYWluLAogCW11dGV4X3VubG9jaygmc21tdV9kb21haW4tPmluaXRfbXV0ZXgpOwog
CiAJLyogUHVibGlzaCBwYWdlIHRhYmxlIG9wcyBmb3IgbWFwL3VubWFwICovCi0Jc21tdV9kb21h
aW4tPnBndGJsX29wcyA9IHBndGJsX29wczsKKwlzbW11X2RvbWFpbi0+cGd0Ymxfb3BzWzBdID0g
cGd0Ymxfb3BzWzBdOworCXNtbXVfZG9tYWluLT5wZ3RibF9vcHNbMV0gPSBwZ3RibF9vcHNbMV07
CisKIAlyZXR1cm4gMDsKIAogb3V0X2NsZWFyX3NtbXU6CkBAIC05NzMsNyArMTA4Niw5IEBAIHN0
YXRpYyB2b2lkIGFybV9zbW11X2Rlc3Ryb3lfZG9tYWluX2NvbnRleHQoc3RydWN0IGlvbW11X2Rv
bWFpbiAqZG9tYWluKQogCQlkZXZtX2ZyZWVfaXJxKHNtbXUtPmRldiwgaXJxLCBkb21haW4pOwog
CX0KIAotCWZyZWVfaW9fcGd0YWJsZV9vcHMoc21tdV9kb21haW4tPnBndGJsX29wcyk7CisJZnJl
ZV9pb19wZ3RhYmxlX29wcyhzbW11X2RvbWFpbi0+cGd0Ymxfb3BzWzBdKTsKKwlmcmVlX2lvX3Bn
dGFibGVfb3BzKHNtbXVfZG9tYWluLT5wZ3RibF9vcHNbMV0pOworCiAJX19hcm1fc21tdV9mcmVl
X2JpdG1hcChzbW11LT5jb250ZXh0X21hcCwgY2ZnLT5jYm5keCk7CiAKIAlhcm1fc21tdV9ycG1f
cHV0KHNtbXUpOwpAQCAtMTMxNywxMCArMTQzMiwzNyBAQCBzdGF0aWMgaW50IGFybV9zbW11X2F0
dGFjaF9kZXYoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLCBzdHJ1Y3QgZGV2aWNlICpkZXYp
CiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHN0cnVjdCBpb19wZ3RhYmxlX29wcyAqCithcm1f
c21tdV9nZXRfcGd0Ymxfb3BzKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwgdW5zaWduZWQg
bG9uZyBpb3ZhKQoreworCXN0cnVjdCBhcm1fc21tdV9kb21haW4gKnNtbXVfZG9tYWluID0gdG9f
c21tdV9kb21haW4oZG9tYWluKTsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2ZnICpjZmcgPSAmc21tdV9k
b21haW4tPmNmZzsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2IgKmNiID0gJnNtbXVfZG9tYWluLT5zbW11
LT5jYnNbY2ZnLT5jYm5keF07CisKKwlpZiAoaW92YSAmIGNiLT5zcGxpdF90YWJsZV9tYXNrKQor
CQlyZXR1cm4gc21tdV9kb21haW4tPnBndGJsX29wc1sxXTsKKworCXJldHVybiBzbW11X2RvbWFp
bi0+cGd0Ymxfb3BzWzBdOworfQorCisvKgorICogSWYgc3BsaXQgcGFnZXRhYmxlcyBhcmUgZW5h
YmxlZCBhZGp1c3QgdGhlIGlvdmEgc28gdGhhdCBpdAorICogbWF0Y2hlcyB0aGUgVDBTWi9UMVNa
IHRoYXQgaGFzIGJlZW4gcHJvZ3JhbW1lZAorICovCit1bnNpZ25lZCBsb25nIGFybV9zbW11X2Fk
anVzdF9pb3ZhKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwKKwkJdW5zaWduZWQgbG9uZyBp
b3ZhKQoreworCXN0cnVjdCBhcm1fc21tdV9kb21haW4gKnNtbXVfZG9tYWluID0gdG9fc21tdV9k
b21haW4oZG9tYWluKTsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2ZnICpjZmcgPSAmc21tdV9kb21haW4t
PmNmZzsKKwlzdHJ1Y3QgYXJtX3NtbXVfY2IgKmNiID0gJnNtbXVfZG9tYWluLT5zbW11LT5jYnNb
Y2ZnLT5jYm5keF07CisKKwlyZXR1cm4gY2ItPnNwbGl0X3RhYmxlX21hc2sgPyBpb3ZhICYgKGNi
LT5zcGxpdF90YWJsZV9tYXNrIC0gMSkgOiBpb3ZhOworfQorCiBzdGF0aWMgaW50IGFybV9zbW11
X21hcChzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sIHVuc2lnbmVkIGxvbmcgaW92YSwKIAkJ
CXBoeXNfYWRkcl90IHBhZGRyLCBzaXplX3Qgc2l6ZSwgaW50IHByb3QpCiB7Ci0Jc3RydWN0IGlv
X3BndGFibGVfb3BzICpvcHMgPSB0b19zbW11X2RvbWFpbihkb21haW4pLT5wZ3RibF9vcHM7CisJ
c3RydWN0IGlvX3BndGFibGVfb3BzICpvcHMgPSBhcm1fc21tdV9nZXRfcGd0Ymxfb3BzKGRvbWFp
biwgaW92YSk7CiAJc3RydWN0IGFybV9zbW11X2RldmljZSAqc21tdSA9IHRvX3NtbXVfZG9tYWlu
KGRvbWFpbiktPnNtbXU7CiAJaW50IHJldDsKIApAQCAtMTMyOCw3ICsxNDcwLDggQEAgc3RhdGlj
IGludCBhcm1fc21tdV9tYXAoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLCB1bnNpZ25lZCBs
b25nIGlvdmEsCiAJCXJldHVybiAtRU5PREVWOwogCiAJYXJtX3NtbXVfcnBtX2dldChzbW11KTsK
LQlyZXQgPSBvcHMtPm1hcChvcHMsIGlvdmEsIHBhZGRyLCBzaXplLCBwcm90KTsKKwlyZXQgPSBv
cHMtPm1hcChvcHMsIGFybV9zbW11X2FkanVzdF9pb3ZhKGRvbWFpbiwgaW92YSksCisJCXBhZGRy
LCBzaXplLCBwcm90KTsKIAlhcm1fc21tdV9ycG1fcHV0KHNtbXUpOwogCiAJcmV0dXJuIHJldDsK
QEAgLTEzMzcsNyArMTQ4MCw3IEBAIHN0YXRpYyBpbnQgYXJtX3NtbXVfbWFwKHN0cnVjdCBpb21t
dV9kb21haW4gKmRvbWFpbiwgdW5zaWduZWQgbG9uZyBpb3ZhLAogc3RhdGljIHNpemVfdCBhcm1f
c21tdV91bm1hcChzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sIHVuc2lnbmVkIGxvbmcgaW92
YSwKIAkJCSAgICAgc2l6ZV90IHNpemUpCiB7Ci0Jc3RydWN0IGlvX3BndGFibGVfb3BzICpvcHMg
PSB0b19zbW11X2RvbWFpbihkb21haW4pLT5wZ3RibF9vcHM7CisJc3RydWN0IGlvX3BndGFibGVf
b3BzICpvcHMgPSBhcm1fc21tdV9nZXRfcGd0Ymxfb3BzKGRvbWFpbiwgaW92YSk7CiAJc3RydWN0
IGFybV9zbW11X2RldmljZSAqc21tdSA9IHRvX3NtbXVfZG9tYWluKGRvbWFpbiktPnNtbXU7CiAJ
c2l6ZV90IHJldDsKIApAQCAtMTM0NSw3ICsxNDg4LDcgQEAgc3RhdGljIHNpemVfdCBhcm1fc21t
dV91bm1hcChzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sIHVuc2lnbmVkIGxvbmcgaW92YSwK
IAkJcmV0dXJuIDA7CiAKIAlhcm1fc21tdV9ycG1fZ2V0KHNtbXUpOwotCXJldCA9IG9wcy0+dW5t
YXAob3BzLCBpb3ZhLCBzaXplKTsKKwlyZXQgPSBvcHMtPnVubWFwKG9wcywgYXJtX3NtbXVfYWRq
dXN0X2lvdmEoZG9tYWluLCBpb3ZhKSwgc2l6ZSk7CiAJYXJtX3NtbXVfcnBtX3B1dChzbW11KTsK
IAogCXJldHVybiByZXQ7CkBAIC0xMzgxLDcgKzE1MjQsNyBAQCBzdGF0aWMgcGh5c19hZGRyX3Qg
YXJtX3NtbXVfaW92YV90b19waHlzX2hhcmQoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLAog
CXN0cnVjdCBhcm1fc21tdV9kb21haW4gKnNtbXVfZG9tYWluID0gdG9fc21tdV9kb21haW4oZG9t
YWluKTsKIAlzdHJ1Y3QgYXJtX3NtbXVfZGV2aWNlICpzbW11ID0gc21tdV9kb21haW4tPnNtbXU7
CiAJc3RydWN0IGFybV9zbW11X2NmZyAqY2ZnID0gJnNtbXVfZG9tYWluLT5jZmc7Ci0Jc3RydWN0
IGlvX3BndGFibGVfb3BzICpvcHM9IHNtbXVfZG9tYWluLT5wZ3RibF9vcHM7CisJc3RydWN0IGlv
X3BndGFibGVfb3BzICpvcHMgPSBhcm1fc21tdV9nZXRfcGd0Ymxfb3BzKGRvbWFpbiwgaW92YSk7
CiAJc3RydWN0IGRldmljZSAqZGV2ID0gc21tdS0+ZGV2OwogCXZvaWQgX19pb21lbSAqY2JfYmFz
ZTsKIAl1MzIgdG1wOwpAQCAtMTQyOSw3ICsxNTcyLDcgQEAgc3RhdGljIHBoeXNfYWRkcl90IGFy
bV9zbW11X2lvdmFfdG9fcGh5cyhzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sCiAJCQkJCWRt
YV9hZGRyX3QgaW92YSkKIHsKIAlzdHJ1Y3QgYXJtX3NtbXVfZG9tYWluICpzbW11X2RvbWFpbiA9
IHRvX3NtbXVfZG9tYWluKGRvbWFpbik7Ci0Jc3RydWN0IGlvX3BndGFibGVfb3BzICpvcHMgPSBz
bW11X2RvbWFpbi0+cGd0Ymxfb3BzOworCXN0cnVjdCBpb19wZ3RhYmxlX29wcyAqb3BzID0gYXJt
X3NtbXVfZ2V0X3BndGJsX29wcyhkb21haW4sIGlvdmEpOwogCiAJaWYgKGRvbWFpbi0+dHlwZSA9
PSBJT01NVV9ET01BSU5fSURFTlRJVFkpCiAJCXJldHVybiBpb3ZhOwpAQCAtMTYyOSw2ICsxNzcy
LDExIEBAIHN0YXRpYyBpbnQgYXJtX3NtbXVfZG9tYWluX2dldF9hdHRyKHN0cnVjdCBpb21tdV9k
b21haW4gKmRvbWFpbiwKIAkJY2FzZSBET01BSU5fQVRUUl9ORVNUSU5HOgogCQkJKihpbnQgKilk
YXRhID0gKHNtbXVfZG9tYWluLT5zdGFnZSA9PSBBUk1fU01NVV9ET01BSU5fTkVTVEVEKTsKIAkJ
CXJldHVybiAwOworCQljYXNlIERPTUFJTl9BVFRSX1NQTElUX1RBQkxFUzoKKwkJCSooKGludCAq
KWRhdGEpID0KKwkJCQkhIShzbW11X2RvbWFpbi0+YXR0cmlidXRlcyAmCisJCQkJICAgKDEgPDwg
RE9NQUlOX0FUVFJfU1BMSVRfVEFCTEVTKSk7CisJCQlyZXR1cm4gMDsKIAkJZGVmYXVsdDoKIAkJ
CXJldHVybiAtRU5PREVWOwogCQl9CkBAIC0xNjY5LDYgKzE4MTcsMTEgQEAgc3RhdGljIGludCBh
cm1fc21tdV9kb21haW5fc2V0X2F0dHIoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLAogCQkJ
ZWxzZQogCQkJCXNtbXVfZG9tYWluLT5zdGFnZSA9IEFSTV9TTU1VX0RPTUFJTl9TMTsKIAkJCWJy
ZWFrOworCQljYXNlIERPTUFJTl9BVFRSX1NQTElUX1RBQkxFUzoKKwkJCWlmICgqKChpbnQgKilk
YXRhKSkKKwkJCQlzbW11X2RvbWFpbi0+YXR0cmlidXRlcyB8PQorCQkJCQkoMSA8PCBET01BSU5f
QVRUUl9TUExJVF9UQUJMRVMpOworCQkJYnJlYWs7CiAJCWRlZmF1bHQ6CiAJCQlyZXQgPSAtRU5P
REVWOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2lvbW11L2lvLXBndGFibGUtYXJtLmMgYi9k
cml2ZXJzL2lvbW11L2lvLXBndGFibGUtYXJtLmMKaW5kZXggNGUyMWVmYi4uNzFlY2IwOCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9pb21tdS9pby1wZ3RhYmxlLWFybS5jCisrKyBiL2RyaXZlcnMvaW9t
bXUvaW8tcGd0YWJsZS1hcm0uYwpAQCAtNDkwLDggKzQ5MCw3IEBAIHN0YXRpYyBpbnQgYXJtX2xw
YWVfbWFwKHN0cnVjdCBpb19wZ3RhYmxlX29wcyAqb3BzLCB1bnNpZ25lZCBsb25nIGlvdmEsCiAJ
aWYgKCEoaW9tbXVfcHJvdCAmIChJT01NVV9SRUFEIHwgSU9NTVVfV1JJVEUpKSkKIAkJcmV0dXJu
IDA7CiAKLQlpZiAoV0FSTl9PTihpb3ZhID49ICgxVUxMIDw8IGRhdGEtPmlvcC5jZmcuaWFzKSB8
fAotCQkgICAgcGFkZHIgPj0gKDFVTEwgPDwgZGF0YS0+aW9wLmNmZy5vYXMpKSkKKwlpZiAoV0FS
Tl9PTihwYWRkciA+PSAoMVVMTCA8PCBkYXRhLT5pb3AuY2ZnLm9hcykpKQogCQlyZXR1cm4gLUVS
QU5HRTsKIAogCXByb3QgPSBhcm1fbHBhZV9wcm90X3RvX3B0ZShkYXRhLCBpb21tdV9wcm90KTsK
LS0gCjIuNy40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpGcmVlZHJlbm8gbWFpbGluZyBsaXN0CkZyZWVkcmVub0BsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9mcmVlZHJlbm8=
